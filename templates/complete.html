<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>保存が完了しました | 振り返りシート</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles.css', v=asset_version) }}"
    />
  </head>
  <body class="complete">
    <main class="complete-card">
      <p class="eyebrow">Upload Complete</p>
      <h1>振り返りシートを保存しました</h1>
      <p class="muted">
        {{ result.teacher.name }} が {{ result.student.name }} さんの記録を
        {{ result.savedAt }} (UTC) に登録しました。
      </p>

      <div class="complete-details">
        <p>
          <strong>ドキュメント:</strong>
          <a href="{{ result.document.webViewLink }}" target="_blank">
            {{ result.document.name }}
          </a>
        </p>
        {% if result.folderLink %}
        <p>
          <strong>フォルダ:</strong>
          <a href="{{ result.folderLink }}" target="_blank">Drive フォルダを開く</a>
        </p>
        {% endif %}
        {% if result.document.webContentLink %}
        <p>
          <strong>ダウンロード:</strong>
          <a href="{{ result.document.webContentLink }}" target="_blank">
            ファイルを開く
          </a>
        </p>
        {% endif %}
        <p>
          <strong>生徒:</strong> {{ result.student.name }} ({{ result.student.grade
          }})
        </p>
      </div>

      <section class="notification-summary">
        <h2>保護者共有</h2>
        {% if result.guardianNotifications %}
        <ul>
          {% for notification in result.guardianNotifications %}
          <li>
            <strong>
              {{ notification.guardian.name }}
              {% if notification.guardian.relationship %}
              （{{ notification.guardian.relationship }}）
              {% endif %}
            </strong>
            ：
            {% if notification.status == "sent" %}
            送信済み
            {% elif notification.status == "failed" %}
            送信失敗
            {% else %}
            宛先未設定
            {% endif %}
            {% if notification.reason %}
            <span class="muted">({{ notification.reason }})</span>
            {% endif %}
          </li>
          {% endfor %}
        </ul>
        {% else %}
        <p class="muted">
          保護者連携が登録されていないため、メール送信は行っていません。
        </p>
        {% endif %}
      </section>

      <div class="actions">
        <a class="primary" href="{{ url_for('index') }}">別の生徒を続ける</a>
      </div>
    </main>
  </body>
</html>
